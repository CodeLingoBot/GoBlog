<article class="article-single article main960 clear" id="article-{{.Article.Id}}">{{with .Article}}
    <header class="header clear">
        <span class="prefix left"></span>
        <span class="right publish">{{DateInt64 .CreateTime "MM.DD"}}</span>
        <h3 class="title"><a href="/article/{{.Id}}/{{.Slug}}.html">{{.Title}}</a></h3>
    </header>
    <aside class="aside">
        <span class="author"><i class="fa fa-user"></i>{{.Author.Display}}</span>
        <span class="category"><a href="{{.Category.Link}}"><i class="fa fa-star"></i>{{.Category.Name}}</a></span>
        <span class="view"><i class="fa fa-eye"></i>{{.Views}} 次浏览</span>
    </aside>
    <section class="content {{.Format}}">{{Html .Content}}</section>
{{end}}</article>
<div id="comment-container" class="main960 clear">
    {{if gt .Article.Comments 0}}<h4>已有 {{.Article.Comments}} 条评论</h4>{{end}}
    <script type="text/juicer" id="comment-item-template">
        <div class="comment-item clear" id="comment-${Id}">
            <img class="avatar left" src="${Avatar}" alt="${Author}" title="${Author}"/>
            <section class="content">$${Content}</section>
            <p class="meta">
                <a class="author" href="#"><i class="fa fa-user"></i>${Author}</a>
                <span class="publish">${CreateTime}</span>
                {@if Status != "approved"}
                <span class="spam msg red">审核中，刷新不可见</span>
                {@/if}
                <a class="reply hide" href="#" rel="${Id}"><i class="fa fa-reply"></i>回复</a>
            </p>
        </div>
    </script>
    <script type="text/juicer" id="comment-child-template">
        <div class="comment-child clear" id="comment-${Id}">
                <a class="right reply" href="#" rel="${Id}"><i class="fa fa-reply"></i>回复</a>
                <img class="avatar left" src="${Avatar}" alt="${Author}" title="${Author}"/>
                <section class="content"><span class="parent"></span>$${Content}{@if Status != "approved"}
                <span class="spam msg red">审核中，刷新不可见</span>
                {@/if}</section>
        </div>
    </script>
    <div id="comment-list"></div>
    <form id="comment-form" class="form clear" action="#" method="post">
        <div class="form-meta left">
            <p class="item">
                <label for="author"><i class="fa fa-user"></i></label>
                <input id="author" class="ipt" type="text" name="author" required="required"/>
            </p>
            <p class="item">
                <label for="email"><i class="fa fa-envelope"></i></label>
                <input id="email" class="ipt" type="email" name="email" required="required"/>
            </p>
            <p class="item">
                <label for="site"><i class="fa fa-link"></i></label>
                <input id="site" class="ipt" type="url" name="site"/>
            </p>
        </div>
        <textarea class="ipt left content" name="content" id="content" required="required"></textarea>
        <button class="btn left item hide green" id="comment-no-reply" type="button">取消回复</button>
        <button class="btn left" id="comment-submit">提 交</button>
        <input type="hidden" name="article" value="{{.Article.Id}}"/>
        <input type="hidden" name="pid" id="comment-parent" value="0"/>
    </form>
</div>
<script src="/static/js/marked.js"></script>
<script src="/static/js/juicer.min.js"></script>
<script src="/static/js/jquery.form.min.js"></script>
<script src="/static/js/ajax-comment.js"></script>
<script>
    $(document).ready(function () {
        var loadPrettify = false;
        $('.md').each(function () {
            var $this = $(this);
            var content = marked($this.text().replace("[break]",""));
            if (content.indexOf("</pre>") >= 1) {
                loadPrettify = true;
            }
            $this.html(content);
        });
        if (loadPrettify) {
            $("<link>")
                    .attr({ rel: "stylesheet",
                        type: "text/css",
                        href: "/static/js/prettify/prettify.css"
                    })
                    .appendTo("head");
            $(".md pre").addClass("prettyprint").addClass("linenums");
            $.getScript("/static/js/prettify/prettify.js",function(){
                prettyPrint();
            });
        }
        Comment.InitCommentList();
        Comment.InitReplyEvent();
        Comment.InitFormEvent();
    });
</script>