<style>
    @import "/static/css/bootstrap-markdown.css";
    @import "/static/js/prettify/prettify.css";
</style>
<form id="article-form" class="clear form" action="/admin/article/new/" method="post">
    <div class="left-col left">
        <input class="ipt full" id="title" type="text" name="title" required="required" placeholder="文章标题"/>
        <textarea name="content" id="content" required="required"></textarea>
    </div>
    <div class="right-col right">
        <p class="item">
            <label for="category">选择分类</label>
            <select class="select" name="category" id="category">{{range .Categories}}
                <option value="{{.Id}}">{{.Name}}</option>
                {{end}}
            </select>
        </p>
        <p class="item">
            <label for="slug">固定链接</label>
            <input id="slug" class="ipt" type="text" name="slug" required="required" placeholder="文章的唯一链接地址"/>
        </p>
        <p class="item">
            <label for="status">保存状态</label>
            <select class="select" name="status" id="status">
                <option value="publish">公开</option>
                <option value="draft">草稿</option>
            </select>
        </p>
        <p class="item">
            <label for="comment">评论状态</label>
            <select class="select" name="comment" id="comment">
                <option value="1">开启</option>
                <option value="0">关闭</option>
            </select>
        </p>
        <p class="item">
            <label for="feed">订阅状态</label>
            <select class="select" name="comment" id="feed">
                <option value="1">开启</option>
                <option value="0">关闭</option>
            </select>
        </p>
        <p>
            <button class="btn" id="article-submit">保存文章</button>
        </p>
    </div>
</form>
<script src="/static/js/bootstrap-markdown.js"></script>
<script src="/static/js/marked.js"></script>
<script src="/static/js/jquery.autosize.js"></script>
<script src="/static/js/prettify/prettify.js"></script>
<script>
    $(document).ready(function () {
        $("#content").markdown({
            autofocus: false,
            savable: false,
            onPreview: function (e) {
                var content = marked(e.getContent(), {
                    breaks: true
                });
                if (content.indexOf("</pre>") >= 1) {
                    setTimeout(function () {
                        $(".md-preview pre").addClass("prettyprint").addClass("linenums");
                        prettyPrint();
                    }, 200);
                }
                return content;
            }
        }).autosize({"append": "\n"});
        $('#article-form').ajaxForm({
            dataType: "json",
            success: function (json) {
                if(json.res){
                    alert("保存完成");
                    window.location.href = "/admin/article/edit/"+json.id+"/";
                }else{
                    alert(json.msg);
                }
            }
        })
    });
</script>